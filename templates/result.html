{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="nav">
        <a href="/">홈</a>
        <a href="{{ url_for('upload_file') }}">파일 업로드</a>
        <a href="{{ url_for('job_list') }}">작업 목록</a>
    </div>
    <h2>작업 결과</h2>
    <div class="info">파일명: {{ job['filename'] }}</div>
    <div class="info">상태: {{ job['status'] }}</div>
    <div class="info">업로드: {{ job.get('uploaded_at', '-') }}</div>
    <div class="info">작업 시작: {{ job.get('started_at', '-') }}</div>
    <div class="info">작업 완료: {{ job.get('completed_at', '-') }}</div>
    <div class="info">작업 소요(초): {{ job.get('duration', '-') }}</div>
    <div class="info">미디어 길이: {{ job.get('media_duration', '-') }}</div>
    <div style="margin:10px 0;display:flex;align-items:center;gap:10px;">
        {% if has_refined %}
        <label style="display:flex;align-items:center;gap:6px;">
            <input type="checkbox" id="toggleOriginal" {% if variant=='original' %}checked{% endif %}>
            <span>원본 보기</span>
        </label>
        <script>
        (function(){
            const cb = document.getElementById('toggleOriginal');
            if (!cb) return;
            cb.addEventListener('change', function(){
                const baseUrl = '{{ url_for('job_status', job_id=job_id) }}';
                const next = cb.checked ? (baseUrl + '?original=true') : baseUrl;
                window.location.href = next;
            });
        })();
        </script>
        {% else %}
        <span style="color:#aaa;">정제본 없음(원본 표시)</span>
        {% endif %}
    </div>
    <div class="result-text">{{ text|safe }}</div>
    <div style="margin-top:10px;">
        <a class="download-btn" href="{{ url_for('download_txt', job_id=job_id) }}">원본 txt 다운로드</a>
        {% if has_refined %}
        <a class="download-btn" href="{{ url_for('download_txt_refined', job_id=job_id) }}" style="margin-left:8px;">정제본 txt 다운로드</a>
        {% endif %}
    </div>
</div>
{% endblock %}
